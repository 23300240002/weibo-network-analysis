# 微博用户邻居网络与其发布内容影响力的关联研究

本项目旨在研究微博用户邻居网络的结构特征与其发布内容流行度之间的关系。通过自动化爬取微博用户的关注网络，提取用户的二跳邻居网络（Ego Network）结构指标，并结合用户内容的流行度，探索网络结构对用户影响力的作用机制。

---

## 项目结构

```
data/
├── core/                        # 核心分析代码
│   ├── new_analysis.py          # 最新的网络指标与流行度相关性分析主脚本
│   └── process_following_network.py # 网络整体结构与可见性分析脚本
├── crawler/                     # 网络数据采集与处理
│   ├── weiboSpider/             # 配置文件（如config.json，存放cookie和用户ID列表）
│   ├── fetch_following.py       # 主爬虫脚本，自动化爬取指定用户的二跳关注网络
│   ├── merge_networks.py        # 合并多个用户网络为大网络
│   └── refind_missed_users.py   # 检查并补全网络中“没有出边”的用户（修复漏爬/隐私用户）
├── old/                         # 历史代码归档
│   ├── before_2025_07/          # 2025年7月前的第一轮自我探索旧代码（已弃用）
│   ├── 2025_07_first_try/       # 2025年7月对旧结果的检查与评判代码（与当前主流程无关）
│   └── test/                    # 各类测试脚本
├── data/                        # 原始微博CSV数据
│   ├── 《网络直播营销活动行为规范》7月1日实施.csv # 微博数据集示例
│   └── ...                      # 其他原始微博数据
├── results/                     # 处理结果目录
│   ├── merged_network_results1/ # 最早爬取的大网络及其指标结果
│   ├── network_analysis/        # 各网络结构分析与可见性分析结果
│   └── old_results/             # 历史分析结果归档
```

---

## 各目录与主要脚本功能说明

### core

- **new_analysis.py**  
  最新的网络指标与流行度相关性分析主脚本。自动加载合并后的大网络数据，计算每个用户的二跳邻居网络（Ego Network）六大结构指标，并与用户内容流行度进行相关性分析，输出统计结果和可视化图表。

- **process_following_network.py**  
  对每个用户网络及合并网络整体结构进行分析，包括节点数、边数、度分布、网络密度、聚类系数、可见性（如没有出边的用户比例）等，输出详细的结构分析报告。

- 其他脚本（如network.py、export_to_jsonl2.py等）为早期特征提取与分析方案，已被new_analysis.py等替代。

### crawler

- **weiboSpider/**  
  存放配置文件（如config.json），需在此文件中填写cookie和要爬取的用户ID列表。

- **fetch_following.py**  
  主爬虫脚本。根据config.json中的cookie和用户ID，自动化爬取指定用户的二跳关注网络，保存用户、边、流行度等数据。用户流行度目前的算法为发布所有帖子的转赞评平均值。支持断点续爬和反爬检测。

- **refind_missed_users.py**  
  检查网络中“没有出边”的用户，自动补全因漏爬或隐私导致的缺失关注关系，提升网络数据完整性。

- **merge_networks.py**  
  合并多个用户的网络数据（用户、边、流行度、节点类别）为一个大网络，便于后续整体分析。

### old

- **before_2025_07/**  
  2025年7月前的第一轮自我探索旧代码，已弃用。

- **2025_07_first_try/**  
  2025年7月对旧结果的检查与评判代码，与当前主流程无关。

- **test/**  
  存放各类测试脚本。

### data

- 存放原始微博CSV数据，每条记录包含作者ID、父微博ID、内容、地区、粉丝数、转发/点赞/评论数、原创/转发标记等。

### results

- **merged_network_results1/**  
  存储第一轮实验最先爬取的大网络及其各类指标分析结果。为目前最新。

- **network_analysis/**  
  存放各网络结构分析、可见性分析等结果报告。

- **old_results/**  
  历史分析结果归档。

---

## 使用方法与流程

### 1. 准备工作

- **获取微博cookie**：需有微博账号，登录后在浏览器开发者工具中获取cookie，并填写到`crawler/weiboSpider/config.json`的`cookie`字段。
- **指定要爬取的用户**：在`config.json`的`user_id_list`字段中填写目标用户ID（可多个）。

### 2. 网络数据采集

- **运行主爬虫**  
  在终端执行：
  ```bash
  python crawler/fetch_following.py
  ```
  功能：自动爬取config.json中所有用户的二跳关注网络，保存每个用户的用户表、边表、流行度表、节点类别等数据。支持断点续爬和反爬检测。

- **补全缺失关注关系（可选）**  
  若需补全网络中“没有出边”的用户（如因隐私或漏爬），可运行：
  ```bash
  python crawler/refind_missed_users.py
  ```
  功能：自动检查并补全ABC类用户的关注列表，提升网络完整性。

### 3. 网络合并（如需整体分析）

- **合并多个用户网络**  
  若需将多个用户的网络合并为大网络，运行：
  ```bash
  python crawler/merge_networks.py
  ```
  功能：自动合并所有用户的用户表、边表、流行度表、节点类别，生成合并后的大网络数据。

### 4. 网络结构与可见性分析

- **分析网络整体结构**  
  可对每个用户网络及合并网络进行结构分析，运行：
  ```bash
  python core/process_following_network.py
  ```
  功能：输出节点数、边数、度分布、网络密度、聚类系数、没有出边的用户比例等结构性报告，辅助理解网络质量与可见性问题。

### 5. 网络指标与流行度相关性分析

- **分析二跳邻居网络结构与流行度的关系**  
  运行：
  ```bash
  python core/new_analysis.py
  ```
  功能：对合并网络中每个用户，自动提取其二跳邻居网络（Ego Network），高效计算六大结构指标，并与用户内容流行度进行相关性分析，输出统计结果与可视化图表。

---

## 研究变量说明

- **自变量X：二跳邻居网络六大结构指标**  
  主要通过EasyGraph高效计算，具体包括：
  1. **density（密度）**：邻居间实际边数与理论最大边数的比值，反映网络紧密程度。
  2. **clustering_coefficient（聚类系数）**：衡量邻居间互相连接的紧密程度。
  3. **average_nearest_neighbor_degree（邻居平均度）**：邻居节点的平均连接数，反映用户周围的活跃度。
  4. **ego_betweenness（局部介数中心性）**：用户在其邻居网络中的桥梁作用。
  5. **spectral_radius（谱半径）**：邻居网络的最大特征值，反映结构复杂性。
  6. **modularity（模块度）**：社区划分的紧密度，反映网络的社区结构明显性。

- **因变量Y：内容流行度**  
  以用户内容的转发、点赞、评论总数（转赞评）为基础，计算平均流行度（avg_popularity）作为用户影响力的衡量。

- **课题意义**  
  本项目通过自动化采集和高效分析，系统考察了微博用户邻居网络结构对其内容影响力的作用机制，为理解社交网络中结构性因素对信息传播和用户影响力的影响提供了实证基础。

---

## 注意事项

1. **依赖库**：请确保已安装以下依赖（可通过pip安装）：
   - pandas
   - numpy
   - matplotlib
   - easygraph
   - tqdm
   - requests
2. **数据量较大时**，网络构建和指标计算可能需要较长时间，请耐心等待。
3. **cookie失效时**，需重新获取并填写。
4. **本项目仅用于学术研究，严禁用于任何违反平台规定的用